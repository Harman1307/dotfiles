#!/bin/bash
# Generate GTK theme from pywal colors with FIXED button contrast

source ~/.cache/wal/colors.sh

# Create gtk-3.0 config
mkdir -p ~/.config/gtk-3.0
cat > ~/.config/gtk-3.0/gtk.css << CSS
/* ===== FORCE DARK BACKGROUNDS ===== */
* {
    background-color: ${color0};
    color: ${color7};
}

window {
    background-color: alpha(${color0}, 0.93);
    color: ${color7};
}

dialog {
    background-color: alpha(${color0}, 0.95);
    color: ${color7};
}

dialog box {
    background-color: ${color0};
    color: ${color7};
}

dialog label {
    color: ${color7};
    background-color: transparent;
}

/* ===== FIX BUTTONS (No white backgrounds) ===== */
button {
    background-image: none;
    background-color: ${color8};
    color: ${color7};
    border: 1px solid ${color8};
    border-radius: 3px;
    padding: 6px 12px;
    box-shadow: none;
    text-shadow: none;
}

button:hover {
    background-image: none;
    background-color: ${color15};
    color: ${color0};
    border: 1px solid ${color15};
}

button:active,
button:checked {
    background-image: none;
    background-color: ${color7};
    color: ${color0};
}

button:disabled {
    background-image: none;
    background-color: alpha(${color8}, 0.3);
    color: ${color8};
}

button label {
    color: inherit;
    background-color: transparent;
}

/* Fix suggested/destructive action buttons */
button.suggested-action {
    background-image: none;
    background-color: ${color15};
    color: ${color0};
}

button.destructive-action {
    background-image: none;
    background-color: #ff5555;
    color: ${color0};
}

/* ===== NOTEBOOK TABS ===== */
notebook {
    background-color: ${color0};
    color: ${color7};
}

notebook header {
    background-color: ${color0};
    border-bottom: 1px solid ${color8};
}

notebook tab {
    background-image: none;
    background-color: alpha(${color8}, 0.3);
    color: ${color7};
    border: 1px solid transparent;
    padding: 8px 16px;
}

notebook tab:checked {
    background-image: none;
    background-color: alpha(${color15}, 0.2);
    color: ${color15};
    border-bottom: 2px solid ${color15};
}

notebook tab label {
    color: inherit;
    background-color: transparent;
}

notebook > stack {
    background-color: ${color0};
}

/* ===== LABELS ===== */
label {
    color: ${color7};
    background-color: transparent;
}

/* ===== FRAMES ===== */
frame {
    border: 1px solid ${color8};
    background-color: ${color0};
}

frame > border {
    border: none;
    background-color: transparent;
}

frame > label {
    color: ${color7};
}

/* ===== LIST BOXES ===== */
list {
    background-color: ${color0};
    color: ${color7};
    border: 1px solid ${color8};
}

list row {
    background-color: transparent;
    color: ${color7};
}

list row:hover {
    background-color: alpha(${color8}, 0.3);
}

list row:selected {
    background-color: alpha(${color15}, 0.3);
    color: ${color15};
}

list row label {
    color: inherit;
}

/* ===== SIDEBAR ===== */
.sidebar {
    background-color: ${color0};
    color: ${color7};
    border-right: 1px solid ${color8};
}

/* ===== MAIN VIEW ===== */
.view {
    background-color: transparent;
    color: ${color7};
}

iconview {
    background-color: transparent;
    color: ${color7};
}

iconview:selected {
    background-color: alpha(${color15}, 0.3);
    color: ${color15};
}

treeview {
    background-color: transparent;
    color: ${color7};
}

treeview:selected {
    background-color: alpha(${color15}, 0.3);
    color: ${color15};
}

treeview header button {
    background-image: none;
    background-color: ${color0};
    color: ${color7};
    border: 1px solid ${color8};
}

/* ===== SCROLLBARS ===== */
scrollbar {
    background-color: transparent;
}

scrollbar slider {
    background-color: alpha(${color8}, 0.6);
    border-radius: 10px;
    min-width: 8px;
    min-height: 8px;
}

scrollbar slider:hover {
    background-color: alpha(${color15}, 0.8);
}

/* ===== ENTRY FIELDS ===== */
entry {
    background-image: none;
    background-color: ${color0};
    color: ${color7};
    border: 1px solid ${color8};
    border-radius: 3px;
    padding: 6px;
    box-shadow: none;
}

entry:focus {
    border: 1px solid ${color15};
    box-shadow: 0 0 3px alpha(${color15}, 0.5);
}

entry:disabled {
    background-color: alpha(${color8}, 0.2);
    color: ${color8};
}

/* ===== COMBOBOX ===== */
combobox button {
    background-image: none;
    background-color: ${color8};
    color: ${color7};
    border: 1px solid ${color8};
}

combobox button arrow {
    color: ${color7};
}

combobox menu {
    background-color: ${color0};
    border: 1px solid ${color8};
}

/* ===== HEADERBAR ===== */
headerbar {
    background-image: none;
    background-color: ${color0};
    color: ${color7};
    border-bottom: 1px solid ${color8};
    box-shadow: none;
}

headerbar button {
    background-image: none;
    background-color: transparent;
}

headerbar entry {
    background-color: alpha(${color0}, 0.7);
}

/* ===== MENUS ===== */
menu {
    background-color: ${color0};
    color: ${color7};
    border: 1px solid ${color8};
}

menuitem {
    background-color: transparent;
    color: ${color7};
    padding: 6px 12px;
}

menuitem:hover {
    background-color: alpha(${color8}, 0.5);
}

menuitem:disabled {
    color: ${color8};
}

menuitem label {
    color: inherit;
}

/* ===== TOOLBAR ===== */
toolbar {
    background-image: none;
    background-color: ${color0};
    color: ${color7};
    border-bottom: 1px solid ${color8};
}

/* ===== PATHBAR ===== */
.path-bar button {
    background-image: none;
    background-color: transparent;
    border: none;
}

.path-bar button:hover {
    background-color: alpha(${color8}, 0.3);
}

/* ===== TOOLTIPS ===== */
tooltip {
    background-color: ${color0};
    color: ${color7};
    border: 1px solid ${color8};
    border-radius: 3px;
}

tooltip label {
    color: ${color7};
}

/* ===== POPOVERS ===== */
popover {
    background-color: ${color0};
    border: 1px solid ${color8};
}

popover label {
    color: ${color7};
}

/* ===== SELECTION BOX ===== */
rubberband {
    background-color: alpha(${color15}, 0.2);
    border: 1px solid ${color15};
}

/* ===== CHECKBOXES & RADIO ===== */
checkbutton check {
    background-image: none;
    background-color: ${color0};
    border: 1px solid ${color8};
    border-radius: 3px;
}

checkbutton check:checked {
    background-image: none;
    background-color: ${color15};
    border-color: ${color15};
    color: ${color0};
    -gtk-icon-source: -gtk-icontheme("object-select-symbolic");
}

checkbutton label {
    color: ${color7};
}

radiobutton radio {
    background-image: none;
    background-color: ${color0};
    border: 1px solid ${color8};
}

radiobutton radio:checked {
    background-image: none;
    background-color: ${color15};
    border-color: ${color15};
}

radiobutton label {
    color: ${color7};
}

/* ===== SPINBUTTONS ===== */
spinbutton {
    background-color: ${color0};
    color: ${color7};
    border: 1px solid ${color8};
}

spinbutton button {
    background-image: none;
    background-color: ${color8};
    color: ${color7};
}

/* ===== PROGRESS BARS ===== */
progressbar {
    background-color: alpha(${color8}, 0.3);
    border-radius: 3px;
}

progressbar progress {
    background-image: none;
    background-color: ${color15};
    border-radius: 3px;
}

/* ===== SEPARATORS ===== */
separator {
    background-color: ${color8};
    min-height: 1px;
    min-width: 1px;
}

/* ===== TEXT VIEWS ===== */
textview {
    background-color: ${color0};
    color: ${color7};
}

textview text {
    background-color: transparent;
    color: ${color7};
}

/* ===== SCALES (Sliders) ===== */
scale {
    background-color: transparent;
}

scale trough {
    background-color: ${color8};
}

scale slider {
    background-image: none;
    background-color: ${color15};
    border: 1px solid ${color15};
}

/* ===== PREVENT ANY WHITE BACKGROUNDS ===== */
.background {
    background-color: ${color0};
}

box {
    background-color: transparent;
}

grid {
    background-color: transparent;
}
CSS

# GTK2 config
mkdir -p ~/.config/gtk-2.0
cat > ~/.config/gtk-2.0/gtkrc << GTK2
gtk-theme-name="Adwaita-dark"
gtk-icon-theme-name="Papirus-Dark"
gtk-font-name="Sans 10"
gtk-cursor-theme-name="Adwaita"
gtk-toolbar-style=GTK_TOOLBAR_ICONS
gtk-menu-images=1
gtk-button-images=1
GTK2

# GTK3 settings
cat > ~/.config/gtk-3.0/settings.ini << SETTINGS
[Settings]
gtk-theme-name=Adwaita-dark
gtk-icon-theme-name=Papirus-Dark
gtk-font-name=Sans 10
gtk-cursor-theme-name=Adwaita
gtk-toolbar-style=GTK_TOOLBAR_ICONS
gtk-menu-images=1
gtk-button-images=1
gtk-application-prefer-dark-theme=1
SETTINGS

echo "âœ“ Fixed white button issue!"
